# Simple Epic Test Fixture

## Purpose

This test fixture provides a minimal but realistic epic for testing the review feedback application workflow. It is used by integration tests to verify that review feedback is correctly applied to epic and ticket files.

## Structure

```
simple-epic/
├── README.md                          # This file
├── simple-epic.epic.yaml              # Minimal epic specification with 3 tickets
├── tickets/                           # Ticket markdown files (created by tests)
│   ├── TEST-001.md
│   ├── TEST-002.md
│   └── TEST-003.md
└── artifacts/                         # Review artifacts and test outputs
    ├── epic-file-review-artifact.md   # Review for epic YAML only
    ├── epic-review-artifact.md        # Review for epic + all tickets
    ├── epic-file-review-updates.md    # Generated by epic-file-review tests
    └── epic-review-updates.md         # Generated by epic-review tests
```

## Test Scenarios

### 1. Epic-File-Review Testing

Tests the workflow where only the epic YAML file is reviewed and updated.

**Artifact:** `artifacts/epic-file-review-artifact.md`

**Expected Changes:**
- Epic YAML file should be updated with improvements from review
- New sections added (non-goals, testing strategy, etc.)
- Coordination requirements enhanced
- Description improved

**Verification:**
- `epic-file-review-updates.md` created in artifacts/
- Document has `status: completed` in frontmatter
- Epic YAML contains expected modifications
- Ticket files remain unchanged

### 2. Epic-Review Testing

Tests the workflow where both epic YAML and ticket markdown files are reviewed and updated.

**Artifact:** `artifacts/epic-review-artifact.md`

**Expected Changes:**
- Epic YAML file updated (testing strategy, coordination requirements)
- TEST-001.md updated (implementation details, acceptance criteria)
- TEST-002.md updated (dependency documentation, testing section)
- TEST-003.md updated (definition of done, validation approach)

**Verification:**
- `epic-review-updates.md` created in artifacts/
- Document has `status: completed` in frontmatter
- Epic YAML contains expected modifications
- All ticket markdown files contain expected modifications
- Changes are appropriate to each file's content

## Using This Fixture

### In Integration Tests

```python
import pytest
from pathlib import Path

@pytest.fixture
def simple_epic_dir():
    """Return path to simple epic test fixture."""
    return Path(__file__).parent.parent.parent / ".epics" / "test-fixtures" / "simple-epic"

def test_epic_file_review(simple_epic_dir):
    epic_file = simple_epic_dir / "simple-epic.epic.yaml"
    review_artifact = simple_epic_dir / "artifacts" / "epic-file-review-artifact.md"

    # Run review feedback application
    # Verify epic file was updated
    # Verify documentation was created
```

### Manual Testing

```bash
# 1. Navigate to test fixture directory
cd .epics/test-fixtures/simple-epic/

# 2. Run epic file review (requires buildspec CLI)
buildspec create-epic simple-epic.epic.yaml
# When prompted for epic-file-review, provide: artifacts/epic-file-review-artifact.md

# 3. Verify changes
cat simple-epic.epic.yaml  # Should show review feedback applied
cat artifacts/epic-file-review-updates.md  # Should exist with status: completed

# 4. Run epic review (requires tickets to exist first)
buildspec create-tickets simple-epic.epic.yaml
# When prompted for epic-review, provide: artifacts/epic-review-artifact.md

# 5. Verify changes
cat simple-epic.epic.yaml  # Should show additional updates
cat tickets/*.md  # Should show ticket-specific updates
cat artifacts/epic-review-updates.md  # Should exist with status: completed
```

## Expected Review Feedback Changes

### Epic File Review

The `epic-file-review-artifact.md` requests these changes:

1. **Add non-goals section** - Clarify what's out of scope
2. **Improve coordination requirements** - Add technical constraints
3. **Enhance description** - Add testing context
4. **Add testing strategy** - Document test approach
5. **Improve ticket descriptions** - Add more detail

### Epic Review

The `epic-review-artifact.md` requests these changes:

**Epic-level:**
- Add testing strategy section
- Enhance coordination requirements with cross-ticket dependencies

**TEST-001:**
- Add implementation details
- Clarify acceptance criteria

**TEST-002:**
- Document dependency on TEST-001
- Add testing section

**TEST-003:**
- Add definition of done
- Document validation approach

**Cross-cutting:**
- Add error handling requirements
- Include logging requirements
- Add performance expectations

## Performance Expectations

Review feedback application should complete in < 30 seconds for this small epic (3 tickets).

Typical timing:
- Epic file review: 10-15 seconds
- Epic review (epic + 3 tickets): 15-25 seconds

## Integration Test Coverage

This fixture is used by the following integration tests:

1. `test_create_epic_with_epic_file_review()` - Full create-epic workflow
2. `test_epic_yaml_updated_by_review_feedback()` - Verify epic changes
3. `test_epic_file_review_documentation_created()` - Verify documentation
4. `test_create_tickets_with_epic_review()` - Full create-tickets workflow
5. `test_epic_and_tickets_updated_by_review_feedback()` - Verify multi-file changes
6. `test_epic_review_documentation_created()` - Verify epic-review docs
7. `test_fallback_documentation_on_claude_failure()` - Error handling
8. `test_error_message_when_review_artifact_missing()` - Missing artifact handling
9. `test_review_feedback_performance()` - Performance verification
10. `test_stdout_stderr_logged_separately()` - Logging verification
11. `test_console_output_provides_feedback()` - Console output verification

## Maintenance

When updating this fixture:

1. Keep it minimal - only 3 tickets for fast test execution
2. Make review feedback predictable and verifiable
3. Update this README if structure changes
4. Ensure review artifacts remain realistic but simple
5. Test both epic-file-review and epic-review scenarios

## Related Files

- Integration tests: `tests/integration/test_review_feedback_integration.py`
- Review feedback module: `cli/utils/review_feedback.py`
- Unit tests: `tests/unit/utils/test_review_feedback.py`
